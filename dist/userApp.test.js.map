{"version":3,"sources":["../dist-esnext/userApp.test.js"],"names":["config","authedUser","dtCreated","Date","ip","calledOnce","notCalled","userRepository","userApp","beforeEach","returns","describe","it","userArgs","userName","email","displayName","password","saveUser","user","passwordHash","save","createdBy","dbUser","userSaved","userNameOrEmail","authUser","form","hashPassword","errors","getAuthToken","authToken","getByUserNameOrEmail","id","ERROR_USERAPP_GETAUTHTOKEN_INVALID_USERNAME_OR_PASSWORD","hasError","verifyAuthToken","token","userByToken","dbUsers","query","options","limit","users","findUsers","find","seed","seeded"],"mappings":"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","file":"userApp.test.js","sourcesContent":["import dotenv from 'dotenv';\ndotenv.config();\nimport { contains, emptyArray, equal, notEmptyArray, notOk, ok } from 'ptz-assert';\nimport { allErrors, createUser } from '@alanmarcell/ptz-user-domain';\nimport { spy, stub } from 'sinon';\nimport { createApp } from './index';\nimport { createUserRepoFake } from './UserRepositoryFake';\nconst authedUser = {\n    dtCreated: new Date(),\n    ip: '192.161.0.1'\n};\nconst calledOnce = 'calledOnce', notCalled = 'notCalled';\nvar userRepository;\nvar userApp;\nbeforeEach(() => {\n    userRepository = createUserRepoFake();\n    spy(userRepository, 'save');\n    stub(userRepository, 'getOtherUsersWithSameUserNameOrEmail').returns([]);\n    userApp = createApp({ userRepository });\n});\ndescribe('UserApp', () => {\n    describe('saveUser', () => {\n        describe('insert', () => {\n            it('hash password', async () => {\n                const userArgs = {\n                    userName: 'angeloocana',\n                    email: 'angeloocana@gmail.com',\n                    displayName: 'Ângelo Ocanã',\n                    password: 'testPassword'\n                };\n                const user = await userApp.saveUser({ userArgs, authedUser });\n                ok(user.passwordHash, 'passwordHash not set');\n                notOk(user.password, 'password not empty');\n            });\n            it('do not call repository if user is invalid', async () => {\n                const userArgs = {\n                    userName: '',\n                    email: '',\n                    displayName: ''\n                };\n                await userApp.saveUser({ userArgs, authedUser });\n                ok(userRepository.save[notCalled]);\n            });\n            it('call repository if User is valid', async () => {\n                const userArgs = {\n                    userName: 'angeloocana',\n                    email: 'angeloocana@gmail.com',\n                    displayName: 'Angelo Ocana'\n                };\n                await userApp.saveUser({ userArgs, authedUser });\n                ok(userRepository.save[calledOnce]);\n            });\n            it('set createdBy', async () => {\n                const userArgs = {\n                    userName: 'angeloocana',\n                    email: 'angeloocana@gmail.com',\n                    displayName: ''\n                };\n                const user = await userApp.saveUser({ userArgs, authedUser });\n                equal(user.createdBy, authedUser);\n            });\n        });\n        describe('update', () => {\n            it('update when new user data is valid', async () => {\n                // spy(userRepository, 'save');\n                // stub(userRepository, 'getOtherUsersWithSameUserNameOrEmail').returns([]);\n                const dbUser = {\n                    userName: 'angeloocana',\n                    email: 'angeloocana@gmail.com',\n                    displayName: 'Angelo Ocana'\n                };\n                stub(userRepository, 'getById').returns(dbUser);\n                const userArgs = {\n                    userName: 'angeloocana',\n                    email: 'angeloocana@gmail.com',\n                    displayName: 'Angelo Ocana Updated'\n                };\n                const userSaved = await userApp.saveUser({ userArgs, authedUser });\n                ok(userRepository.save[calledOnce]);\n                equal(userSaved.displayName, userArgs.displayName);\n            });\n        });\n    });\n    describe('authUser', () => {\n        it('return null when User not found', async () => {\n            const userNameOrEmail = 'angeloocana', password = 'teste';\n            stub(userRepository, 'getByUserNameOrEmail').returns(null);\n            const user = await userApp.authUser({\n                form: { userNameOrEmail, password },\n                authedUser\n            });\n            notOk(user);\n        });\n        it('return null when User found but incorrect password', async () => {\n            const password = 'testeteste';\n            var user = createUser({\n                userName: 'angeloocana',\n                email: '',\n                displayName: '',\n                password\n            });\n            user = await userApp.hashPassword(user);\n            stub(userRepository, 'getByUserNameOrEmail').returns(user);\n            user = await userApp.authUser({\n                form: {\n                    userNameOrEmail: user.userName,\n                    password: 'incorrectPassword'\n                },\n                authedUser\n            });\n            notOk(user);\n        });\n        it('return user when correct password', async () => {\n            const password = 'testeteste';\n            var user = createUser({\n                userName: 'angeloocana',\n                email: 'alanmarcell@live.com',\n                displayName: 'Angelo Ocana',\n                password\n            });\n            user = await userApp.hashPassword(user);\n            stub(userRepository, 'getByUserNameOrEmail').returns(user);\n            user = await userApp.authUser({\n                form: {\n                    userNameOrEmail: user.userName,\n                    password\n                },\n                authedUser\n            });\n            ok(user);\n            emptyArray(user.errors);\n        });\n    });\n    describe('getAuthToken', () => {\n        it('add errors when invalid userName or Email', async () => {\n            spy(userRepository, 'getByUserNameOrEmail');\n            const authToken = await userApp.getAuthToken({\n                form: {\n                    userNameOrEmail: 'ln',\n                    password: 'testtest'\n                },\n                authedUser\n            });\n            ok(userRepository.getByUserNameOrEmail[notCalled], 'Do NOT call repository getByUserNameOrEmail()');\n            notOk(authToken.authToken, 'Do NOT Generate token');\n            notOk(authToken.user, 'DO NOT return user');\n            notEmptyArray(authToken.errors, 'return errors');\n        });\n        it('add error when invalid password', async () => {\n            spy(userRepository, 'getByUserNameOrEmail');\n            const authToken = await userApp.getAuthToken({\n                form: {\n                    userNameOrEmail: 'angeloocana',\n                    password: 't'\n                },\n                authedUser\n            });\n            ok(userRepository.getByUserNameOrEmail[notCalled], 'Do NOT call repository getByUserNameOrEmail()');\n            notOk(authToken.authToken, 'Do NOT Generate token');\n            notOk(authToken.user, 'DO NOT return user');\n            notEmptyArray(authToken.errors, 'return errors');\n        });\n        it('generate token when correct password', async () => {\n            var user = createUser({\n                userName: 'lnsilva',\n                email: 'lucas.neris@globalpoints.com.br', displayName: 'Lucas Neris',\n                password: '123456'\n            });\n            user = await userApp.hashPassword(user);\n            stub(userRepository, 'getByUserNameOrEmail').returns(user);\n            const authToken = await userApp.getAuthToken({\n                form: {\n                    userNameOrEmail: 'lnsilva',\n                    password: '123456'\n                },\n                authedUser\n            });\n            ok(authToken.authToken, 'Empty Token');\n            ok(authToken.user, 'no user');\n            ok(authToken.user.id, 'no user id');\n            emptyArray(authToken.errors, 'return errors');\n        });\n        it('add errors when incorrect password', async () => {\n            stub(userRepository, 'getByUserNameOrEmail').returns(null);\n            const authToken = await userApp.getAuthToken({\n                form: {\n                    userNameOrEmail: 'lnsilva',\n                    password: '123456'\n                },\n                authedUser\n            });\n            notOk(authToken.authToken, 'do not generate token');\n            notOk(authToken.user, 'do not return user');\n            contains(authToken.errors, allErrors.ERROR_USERAPP_GETAUTHTOKEN_INVALID_USERNAME_OR_PASSWORD, 'return invalid userName, email or password error');\n        });\n    });\n    describe('verifyAuthToken', () => {\n        it('Invalid token throws exception', async () => {\n            var hasError = false;\n            try {\n                await userApp.verifyAuthToken({\n                    token: 'Invalid_Token',\n                    authedUser\n                });\n            }\n            catch (err) {\n                hasError = true;\n            }\n            ok(hasError);\n        });\n        it('Valid token return user', async () => {\n            var user = createUser({\n                userName: 'lnsilva',\n                email: 'lucas.neris@globalpoints.com.br',\n                displayName: 'Lucas Neris',\n                password: '123456'\n            });\n            user = await userApp.hashPassword(user);\n            stub(userRepository, 'getByUserNameOrEmail').returns(user);\n            const authToken = await userApp.getAuthToken({\n                form: {\n                    userNameOrEmail: 'lnsilva',\n                    password: '123456'\n                },\n                authedUser\n            });\n            ok(authToken.authToken, 'Empty Token');\n            const userByToken = await userApp.verifyAuthToken({\n                token: authToken.authToken,\n                authedUser\n            });\n            equal(userByToken.id, user.id, 'User Id dont match');\n            equal(userByToken.email, user.email, 'User Id dont match');\n            equal(userByToken.userName, user.userName, 'User Id dont match');\n            equal(userByToken.displayName, user.displayName, 'User Id dont match');\n        });\n    });\n    describe('updatePassword', () => {\n        it('return error when wrong password');\n        it('return error when invalid password');\n        it('update');\n    });\n    describe('updatePasswordToken', () => {\n        it('return error when wrong token');\n        it('return error when invalid password');\n        it('update');\n    });\n    describe('deleteUser', () => {\n        it('return error when user not found');\n        it('return error when authuser is not admin or the deleted user');\n        it('delete');\n    });\n    describe('findUsers', () => {\n        it('call repository', () => {\n            const dbUsers = [];\n            stub(userRepository, 'find').returns(dbUsers);\n            const query = {};\n            const options = { limit: 4 };\n            const users = userApp.findUsers({ authedUser, options, query });\n            ok(userRepository.find[calledOnce]);\n            equal(users, dbUsers, 'users not returned');\n        });\n    });\n    describe('seed', () => {\n        it('default users', async () => {\n            const seeded = await userApp.seed(authedUser);\n            ok(seeded);\n        });\n        it('custom users');\n    });\n});\n//# sourceMappingURL=userApp.test.js.map"]}